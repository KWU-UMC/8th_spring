# Spring Security

Spring Security는 Spring Framework 기반의 애플리케이션에 인증(Authentication)과 인가(Authorization)를 제공하는 보안 프레임워크

### 핵심 기능

1. **인증(Authentication)**
    - 사용자의 신원을 확인함 (로그인)
    - `UsernamePasswordAuthenticationFilter` 등이 이를 처리함
2. **인가(Authorization)**
    - 인증된 사용자의 권한(Role/Authority)에 따라 접근을 제어
    - URL, 메서드, 도메인 객체 수준의 접근 제어 가능
3. **세션 관리 및 CSRF 보호**
    - 세션 고정 공격 방지
    - CSRF 토큰을 통한 요청 위조 방지
4. **암호화**
    - 비밀번호를 `BCryptPasswordEncoder` 등으로 암호화
5. **필터 체인 기반 구조**
    - `SecurityFilterChain`을 통해 요청 처리 전후에 보안 관련 필터 적용

### 인증 흐름 요약

1. 사용자가 로그인 폼에 아이디/비밀번호 입력
2. `UsernamePasswordAuthenticationFilter`가 이를 감지
3. `AuthenticationManager`가 인증 시도
4. 성공 시 `SecurityContext`에 사용자 정보 저장
5. 이후 모든 요청은 인증된 상태로 처리

# 인증(Authentication)과 인가(Authorization)

**인증(Authentication)**

- 사용자의 신원을 확인함 (로그인)
- `UsernamePasswordAuthenticationFilter` 등이 이를 처리함

**인가(Authorization)**

- 인증된 사용자의 권한(Role/Authority)에 따라 접근을 제어
- URL, 메서드, 도메인 객체 수준의 접근 제어 가능

# 세션과 토큰

### 세션(Session)이란?

> 서버가 사용자의 로그인 상태를 기억하는 방식
>
- 사용자가 로그인하면 서버가 **세션 ID**를 생성해서 클라이언트(브라우저)에 보냄 (보통 쿠키에 저장됨)
- 이후 사용자는 요청마다 이 세션 ID를 함께 보내고,
- 서버는 이 ID를 이용해 해당 사용자의 로그인 정보를 **서버 메모리에서 꺼내서** 처리함

**서버가 사용자 상태(로그인 여부 등)를 기억함** → 상태를 가진 방식 (stateful)

### 토큰(Token)이란?

> 서버가 사용자에게 인증 정보를 담은 ‘증명서’를 발급하는 방식
>
- 사용자가 로그인하면 서버가 **JWT 같은 토큰**을 발급해줌
- 사용자는 이후 모든 요청에 이 토큰을 **헤더에 넣어서 보냄**
- 서버는 이 토큰을 검증해서 사용자 정보 확인

**서버는 사용자 상태를 기억하지 않고**, 토큰만으로 매번 인증함 → 상태 없는 방식 (stateless)

둘의 차이는 이렇게 볼 수 있어:

| 비교 항목 | 세션 | 토큰 (예: JWT) |
| --- | --- | --- |
| 인증 정보 저장 위치 | 서버 | 클라이언트 |
| 서버 상태 유지 | O (stateful) | X (stateless) |
| 요청 처리 방식 | 세션 ID로 서버가 상태 확인 | 토큰 검증으로 상태 확인 |
| 예시 | 웹사이트 로그인 | 모바일 앱, API 서버 등 |


# 액세스 토큰(Access Token)과 리프레시 토큰(Refresh Token)

**둘 다 JWT 기반 인증에서 사용되는 토큰 방식의 인증 수단**

### 액세스 토큰 (Access Token)

> 사용자가 인증되었음을 증명하는 짧은 유효기간의 토큰
>
- API 요청 시 `Authorization: Bearer <액세스 토큰>` 으로 전송됨
- 서버는 이 토큰을 검증해서 유저 정보를 파악하고 요청을 처리함
- 일반적으로 **유효기간이 짧음** (예: 15분 ~ 1시간)

**장점**: 유출돼도 짧은 시간만 위험

**단점**: 만료되면 재로그인 or 갱신 필요

### 리프레시 토큰 (Refresh Token)

> 새로운 액세스 토큰을 발급받기 위한 긴 유효기간의 토큰
>
- 액세스 토큰이 만료되었을 때, 이 리프레시 토큰을 서버에 보내 **새 액세스 토큰을 요청**
- 주로 서버나 DB에 저장하여 **유효성과 재사용 여부를 검증함**
- 유효기간은 보통 **수일 ~ 수주** (긴 기간)

**장점**: 사용자는 자주 로그인하지 않아도 됨

**단점**: 유출되면 더 큰 보안 위협 → 서버에서 관리 필요

### 구조와 흐름

1. 사용자가 로그인 → 액세스 토큰 + 리프레시 토큰 발급
2. 클라이언트는 액세스 토큰으로 API 요청
3. 액세스 토큰이 만료되면 리프레시 토큰으로 새 액세스 토큰 요청
4. 리프레시 토큰도 만료되거나 유효하지 않으면 → **재로그인 필요**

### 비교 요약

| 항목 | 액세스 토큰 | 리프레시 토큰 |
| --- | --- | --- |
| 목적 | API 접근 인증용 | 액세스 토큰 재발급용 |
| 유효기간 | 짧음 (분 단위) | 김 (일~주 단위) |
| 저장 위치 (권장) | 메모리, 쿠키, 로컬스토리지 등 | 서버(또는 보안된 쿠키 등) |
| 보안 위험 발생 시 | 제한적 피해 | 큰 피해 가능 → 철저한 관리 필요 |
| 노출 시 대응 | 새 토큰 발급 | 즉시 블랙리스트 처리 및 로그아웃 |

