# 10주차 키워드

## Spring Security
- Spring의 프레임워크 중 하나로 필요한 데이터에 안전하고 빠르게 접근하도록 지원하며, 고객 정보 및 거래 데이터를 승인되지 않는 접근으로부터 보호하여 고객 데이터를 효율적으로 관리하는 데 도움을 줌
- 보안에 필요한 기능들을 제공하여 개발 작업 효율을 높일 수 있음

## 인증(Authentication)과 인가(Authorization)
### 인증(Authentication)
- 인증(Authentication)은 사용자의 신원을 입증하는 과정 (ex. 사용자가 로그인할 때 누구인지 확인하는 과정)
- 특정한 인증 요소를 통해 자신의 신원을 확인할 수 있음
- 로그인을 위해 자신의 ID, PW를 입력하는 행위를 인증이라고 볼 수 있음
- 단일 인증 이후에도 여러 개의 인증 절차를 거칠 수 있음 (ex. OTP, 보안카드 등)

### 인가(Authorization)
- 인가(Authorization)는 사이트의 특정 부분에 접근할 수 있는지 권한을 확인하는 작업 (ex. 관리자 페이지에 접근 가능한가)
- 접근 권한을 얻는 과정이라고 볼 수 있으며, 인증 이후의 프로세스라고 볼 수 있음
- 인터넷 기반 서비스에서는 token을 사용, 사용자는 token에 기재된 자신의 인가 정보를 통해 서버로부터 인증을 받고 서비스를 사용할 수 있게 됨

### 인증과 인가의 차이점
1. 인증 > 인가로 이어질 수 있지만 인가 > 인증으로는 이어질 수 없음
2. 인증은 권한 부여 결정의 일부 요소로 사용될 수 있음
3. 권한 부여로 인증을 하기에는 유용하지 않을 수 있음

## 세션과 토큰
### 세션(session)
- 사용자가 인증에 성공한 상태
- 세션 기반 인증방식은 서버에서 유저의 상태를 관리함

### 토큰(token)
- 토큰은 승차권같이 무언가를 이용할 수 있는 권한이나 자격을 나타내는 징표
- 세션 기반 인증방식에서 서버의 부담을 줄이기 위해 사용자의 인증상태를 서버에 저장하는 것이 아닌 클라이언트에 저장하는 방법을 고안한 것이 토큰

### 세션기반 인증방식
1. 유저가 인증 정보를 담아 서버에 로그인 요청을 보냄
2. 서버는 DB에 저장된 유저의 인증정보를 확인
3. 인증에 성공시, 해당 유저에 대한 세션을 생성하고 이를 서버 메모리에 저장
4. 쿠키를 통해 해당 유저의 세션 ID를 클라이언트에 전달
5. 클라이언트에 세션 ID 저장
6. 클라이언트에서 서버로 리소스 요청을 할 때, 쿠키에서 세션 ID가 함께 전달됨 (GET/info)
7. 서버는 전달받은 세션 ID를 토대로 유저의 세션 데이터를 조회함
8. 세션이 유효하다면, 유저의 요청에 대한 응답 데이터를 전송 

### 토큰기반 인증방식
1. 유저가 인증 정보를 담아 서버에 로그인 요청을 보냄
2. 서버는 DB에 저장된 유저의 인증정보 확인
3. 인증에 성공시, 서버는 유저에 대한 권한 정보를 서버의 비밀키와 함께 토큰을 생성
4. 서버는 인가(Authorization) 헤더에 토큰을 담아 클라이언트에 전달
5. 클라이언트는 전달받은 토큰을 브라우저의 세션 스토리지나 로컬 스토리지에 저장
6. 클라이언트가 서버로 리소스를 요청할 때, 인가 헤더를 통해 토큰이 함께 전달됨
7. 서버는 전달받은 토큰을 서버의 비밀키로 검증하여, 이를 통해 토큰의 유효기간과 위조 여부를 확인할 수 있음
8. 토큰이 유효하다면, 유저의 요청에 대한 응답 데이터를 전송


## 액세스 토큰(Access token)과 리프레시 토큰(Refresh token)
- JWT토큰은 유저의 신원이나 권한을 결정하는 정보를 담고 있는 데이터 조각
- JWT토큰 인증 방식은 비밀키로 암호화를 하기 때문에 서버와 클라이언트는 안전하게 통신함
- 토큰을 탈취당했을 때 클라이언트위 탈취자를 구분할 수 없기 때문에 유효 기간을 둠
- 여기서 유효기간을 짧게 두면 사용자가 로그인을 자주 해야하고, 유효기간을 길게 두면 보안상 탈취 위험에서 벗어날 수 없음
- 이를 해결하기 위해 유효기간이 다른 JWT토큰 2개 (Access token과 Refresh token)를 두는 것

### 액세스 토큰(Access token)
- 액세스 토큰의 유효기간은 짧음(ex. 60일, 1시간 등)
- 평소 API 통신에 사용됨

### 리프레시 토큰(Refresh token)
- 리프레시 토큰의 유효기간은 김(ex. 1년 등)
- Access token이 만료되어 갱신할 때 사용

### 서버-클라이언트 통신
1. 로그인 인증에 성공한 클라이언트는 Access token과 Refresh toekn 두 개를 서버로부터 받음
2. 클라이언트는 두 토큰을 로컬에 저장함
3. 클라이언트는 헤더에 Access token을 넣고 API 통신을 함 -> Authorization
4. 일정 기간이 지나 Access token의 유효기간이 만료됨
5. Access token은 이제 유효하지 않으므로 권한이 없는 사용자가 됨
6. 클라이언트로부터 유효기간이 지난 Access token을 받은 서버는 401 에러 코드로 응답
7. 401을 통해 클라이언트는 invalid_token (유효기간이 만료됨)을 알 수 있음
8. 헤더에 Access token 대신 Refresh token을 넣어 API를 재요청함
9. Refresh token으로 사용자의 권한을 확인한 서버는 응답 쿼리 헤더에 새로운 Access token을 넣어 응답함
10. 만약 Refresh token도 만료되었다면 서버는 동일하게 401 에러 코드를 보내고, 클라이언트는 재로그인함